(()=>{"use strict";var e=0;function n(n){var t=n.loadFun,r=n.reloadFun,o=n.element,l=n.onShowTarget,i=new IntersectionObserver((function(n,o){console.log(n[0].target===l[e%4]),n[0].isIntersecting?(t(i),e++):n[0].target===l[e%4]&&(r(i),e--)}));i.observe(o)}var t=[],r=[];for(var o=[],l=0;l<1e5;l++)o.push({value:"list_"+l});!function(e,o,l){var i=0,a=function(e){var n=document.querySelector("#div");if(!n)throw new Error("element is not exists");var t=document.createElement("span");t.className="after_el";var r=document.createElement("span");return r.className="before_el",n.appendChild(r),n.appendChild(t),{el:n,targetEl:t,beforeEl:r}}(),u=a.el,c=a.targetEl,s=a.beforeEl;n({element:u,onShowTarget:t,loadFun:function(e){(function(e,n,o,l,i,a){var u=document.createDocumentFragment(),c=function(e){var n=e.index,t=e.listArr,r=e.loadFunction,o=20*n,l=20*(n+1),i=document.createElement("ul"),a="long_list_ul_"+n;return i.id=a,t.slice(o,l).forEach((function(e){i.appendChild(r(e))})),i}({listArr:l,index:i,loadFunction:a});u.appendChild(c),n.insertBefore(u,o),function(e,n,o){if(t.length>5){var l=t.shift();o.unobserve(l),r.push(l),e.removeChild(l)}t.push(n)}(n,c,e),e.observe(c)})(e,u,c,o,i,l),i++},reloadFun:function(){(function(e,n){if(t.length>5)return!1;var o=document.createDocumentFragment(),l=r.shift();return console.log(l),!!l&&(o.appendChild(l),console.log(n.nextSibling),e.insertBefore(o,n.nextSibling),function(e,n){if(t.length>5){var r=t.pop();e.removeChild(r),t.unshift(n)}}(e,l),!0)})(u,s)&&i--}})}(0,o,(function(e){var n=document.createElement("li");return n.innerHTML=e.value,n}))})();